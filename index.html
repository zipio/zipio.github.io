<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Document</title>
    <!-- cyborg,journal,readable,spacelab,darkly,lumen,sandstone,superhero,cerulean,flatly,simplex,united,cosmo,paper,slate,yeti -->
    <link rel="stylesheet" href="//cdn.jsdelivr.net/g/bootswatch(yeti/bootstrap.min.css)">
    <style>
    body {
        margin-top: 1em;
    }
    
    .btn-wide {
        width: 100%;
    }
    
    .pad-bottom {
        margin-bottom: .8em;
    }
    </style>
</head>

<body>
    <div class="container">
        <div class="row" data-bind="foreach: tables">
            <div class="col-sm-12">
                <h2 data-bind="text: name"></h2>
                <table class="table table-striped">
                    <thead>
                        <tr data-bind="foreach: fields.concat([''])">
                            <th data-bind="text: $data"></th>
                        </tr>
                    </thead>
                    <tbody data-bind="foreach: table">
                        <tr>
                        	<!-- ko foreach: $parent.fields -->
                            <td data-bind="text: $parent[$data]"></td>
                            <!-- /ko -->
                            <td><a data-bind="click: $parent.remove">remove</a></td>
                        </tr>
                    </tbody>
                </table>
                <form class="form-horizontal" data-bind="submit: add">
                    <div class="row">
                        <!-- ko foreach: fields -->
                        <div class="col-sm-3">
                            <input class="form-control pad-bottom" data-bind="value: $parent.data[$data]" />
                        </div>
                        <!-- /ko -->
                        <div class="col-sm-3">
                            <button class="btn btn-default btn-wide pad-bottom" type="submit" data-bind="text: 'Add to ' + name"></button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!-- chance,momentjs,sugar,knockout,bootstrap,lodash,hammerjs,chartist.js,ion.rangeslider,firebase -->
    <script src="//cdn.jsdelivr.net/g/jquery@2,knockout,momentjs,underscorejs,chance"></script>
    <script src="https://cdn.firebase.com/v0/firebase.js"></script>
    <script src="//cdn.rawgit.com/tyrsius/FireBind/master/firebind.js"></script>
    <script src="app.js"></script>
    <script>
    $(function() {

        var random = new Chance();

        // // Initialize Firebase
        // var config = {
        //     apiKey: "AIzaSyBsy_AjKSmEPoNfqomI4xFm7syXgyHztec",
        //     authDomain: "yapa-532be.firebaseapp.com",
        //     databaseURL: "https://yapa-532be.firebaseio.com",
        //     storageBucket: "yapa-532be.appspot.com",
        // };
        // var root = firebase.initializeApp(config);

        var firebase = new Firebase('yapa-532be.firebaseio.com/');

        var vm = new ViewModel(firebase);

        // function newRandomCustomer() {
        //     var gender = random.gender();
        //     vm.customer.title(random.prefix({
        //         gender: gender
        //     }));
        //     vm.customer.firstname(random.first({
        //         gender: gender
        //     }));
        //     vm.customer.lastname(random.last({
        //         gender: gender
        //     }));
        // }

        function tableGenerator(tableName, fields) {

            var table = ko.fireSet(firebase.child(tableName), Model);

            var data = _.reduce(fields, function(memo, field) {
                memo[field] = ko.observable();
                return memo;
            }, {});

            function Model(id, data, fireRef) {
                var self = this,
                    map = {};
                _.each(fields, function(field) {
                    map[field] = data[field] || '';
                });
                self.id = id;
                ko.fireModel(self, map, fireRef);
            }

            function add() {
                table.push(data);
            }

            function remove(item) {
                table.remove(item);
            }

            return {
            	name: tableName,
                table: table,
                data: data,
                add: add,
                remove: remove,
                fields: fields
            };
            
        }

        function ViewModel(firebase) {

            var self = this;

            self.tables = [
            	tableGenerator('users', ['username', 'firstname', 'lastname']),
            	tableGenerator('customers', ['title', 'firstname', 'lastname'])
        	];

        }

        ko.applyBindings(vm);

    });
    </script>
</body>

</html>
